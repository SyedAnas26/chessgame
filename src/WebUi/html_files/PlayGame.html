<!DOCTYPE unspecified PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<head>
    <head>
        <script>
            history.forward();
        </script>
    </head>
    <!-- Order of inclusion : Library -> Utilities -> Pieces -> Controls -->

    <script type="text/javascript" src="../clientlib/jquery.min-3.5.js"></script>
    <script type="text/javascript" src="../clientlib/jquery-ui.min.js"></script>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css"
          integrity="sha384-q94+BZtLrkL1/ohfjR8c6L+A6qzNH9R2hBLwyoAfu3i/WCvQjzL2RQJ3uNHDISdU" crossorigin="anonymous">
    <script type="text/javascript">
        statusCalled = false;
        var x = window.location.origin;
        $.ajax({
            url: x + "/getUserId",
            type: 'POST',
            success: function (response) {
                if (response.user_id === 'null') {
                    alert(' Login First !');
                    location = '/loginpage';
                }
                console.log('difficulty ajax success!!');
            }
        });

        window.onload = (event) => {
            startNew();
        };
    </script>
</head>
<body>
<div id="myBoard" style="width: 500px"></div>
<div id="status"></div>
<script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"
        integrity="sha384-8Vi8VHwn3vjQ9eUHUxex3JSN/NFqUg3QbPyX8kWyb93+8AC/pPWTzj+nHtbC5bxD"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.2/chess.js"
        integrity="sha384-s3XgLpvmHyscVpijnseAmye819Ee3yaGa8NxstkJVyA6nuDFjt59u1QvuEl/mecz"
        crossorigin="anonymous"></script>
<script type="text/javascript">
    var step;
    var alertStatus = null;
    var game = new Chess()

    function onMoveEnd(oldPos, newPos) {
        if (alertStatus != null) {
            alert(alertStatus);
            alertStatus = null;
        }
    }

    var config = {
        position: 'start',
        onMoveEnd: onMoveEnd
    }
    var board = Chessboard('myBoard', config)


    function nextStep() {
        var x = window.location.origin;
        if (!statusCalled) {
            var status;
            $.ajax({
                url: x + "/nextstep",
                type: 'POST',
                success: function (response) {
                    step = response.step;
                    if (response.checkStatus === "Draw") {
                        alertStatus = "Match Draw!";
                        statusCalled = true;
                    } else if (response.checkStatus === "Player1") {
                        alertStatus = "Player 1 Wins (White)!";
                        statusCalled = true;
                    } else if (response.checkStatus === "Player2") {
                        alertStatus = "Player 2 Wins (Black)!";
                        statusCalled = true;
                    }
                    var pgnMove = response.pgn;
                    game.move(pgnMove)
                    board.position(game.fen())

                }
            });

        }

    }

    function prevStep() {

        var stepInt = parseInt(step);

        if (stepInt > 0) {
            var x = window.location.origin;
            $.ajax({
                url: x + "/previous_step",
                type: 'POST',
                success: function (response) {
                    statusCalled = false;
                    game.undo()
                    board.position(game.fen())
                    step--;
                }

            });
        }
    }

    function startNew() {
        //window.location.reload();
        var x = window.location.origin;
        $.ajax({
            url: x + "/startnewgame",
            type: 'POST',
            data: {"StartAgain": "true"},
            success: function () {
                console.log('difficulty ajax success!!');
            }
        });

        statusCalled = false;

    }
</script>
<br>
<br>
<input type="button" onclick="nextStep()" value="Next Step" cellpadding="0" cellspacing="0"/>
<br>
<br>
<input type="button" onclick="prevStep()" value="Previous Step" cellpadding="0" cellspacing="0"/>
<br>
<br>
<input type="button" onclick="startNew();window.location.reload();" value="Start Again" cellpadding="0"
       cellspacing="0"/>
<br>
<form action="/homepage" method="post" align="center">
    <input type="submit" value="Go Back to Home Page"/>
</form>
</body>
</html>
 