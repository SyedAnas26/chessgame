<!DOCTYPE unspecified PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<head>
    <head>
        <script>
            history.forward();
        </script>
    </head>
    <style type="text/css">
        #pgn {
            background-color: white;
            width: 15%;
            height: 480px;
            border: 2px solid black;
            padding: 10px;
            margin-right: 30px;
            overflow: auto;
        }
        #GameBox{
            border: 1px solid white;
            width: 510px;
            height: 510px;
            float: left;
        }
        .button{
            padding-top: 50px;
            padding-right: 50px;
            width: 50px;
        }
        .bot{
            margin-left: 20px;
            padding: 5px;
            width: 280px;
        }
        th {
            border: 30px solid white;
            height: 100px;
        }
    </style>
    <!-- Order of inclusion : Library -> Utilities -> Pieces -> Controls -->

    <script type="text/javascript" src="../clientlib/jquery.min-3.5.js"></script>
    <script type="text/javascript" src="../clientlib/jquery-ui.min.js"></script>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css"
          integrity="sha384-q94+BZtLrkL1/ohfjR8c6L+A6qzNH9R2hBLwyoAfu3i/WCvQjzL2RQJ3uNHDISdU" crossorigin="anonymous">
    <script type="text/javascript">
        statusCalled = false;
        var x = window.location.origin;
        $.ajax({
            url: x + "/getUserId",
            type: 'POST',
            success: function (response) {
                if (response.user_id === 'null') {
                    alert(' Login First !');
                    location = '/loginpage';
                }
                console.log('difficulty ajax success!!');
            }
        });

        window.onload = (event) => {
            startNew();
        };
    </script>
</head>
<body>
<div id="GameBox">
    <div id="myBoard" style="width: 500px"></div>
</div>
<div id="pgn"><div><p id="showpgn" style="font-size: 20px;">PGN:</p></div>
</div>
<div class="bot">
    <table>
        <tr>
            <th><input type="button" onclick="nextMove()" value="Next Step" cellpadding="0" cellspacing="0"/></th>
            <th><input type="button" onclick="prevStep()" value="Previous Step" cellpadding="0" cellspacing="0"/></th>
            <th><input type="button" onclick="startNew();window.location.reload();" value="Start Again" cellpadding="0"
                       cellspacing="0"/></th>
        </tr>
    </table>
</div>
<div class="bot">
    <form action="/homepage" method="post" align="center">
        <input style="margin-left: 150px"type="submit" value="Go Back to Home Page"/>
    </form>
</div>
<script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"
        integrity="sha384-8Vi8VHwn3vjQ9eUHUxex3JSN/NFqUg3QbPyX8kWyb93+8AC/pPWTzj+nHtbC5bxD"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.2/chess.js"
        integrity="sha384-s3XgLpvmHyscVpijnseAmye819Ee3yaGa8NxstkJVyA6nuDFjt59u1QvuEl/mecz"
        crossorigin="anonymous"></script>
<script type="text/javascript">
    var step = 0;
    var nextCalled = false;
    var prevMoveCalled = false;
    var alertStatus = null;
    var $pgn = $('#showpgn')
    var game = new Chess()

    function onMoveEnd(oldPos, newPos) {
        if (alertStatus != null) {
            alert(alertStatus);
            alertStatus = null;
        }
        $pgn.html("PGN: "+game.pgn())

    }

    var config = {
        position: 'start',
        onMoveEnd: onMoveEnd
    }
    var board = Chessboard('myBoard', config)


    function nextMove() {
        var x = window.location.origin;
        if (!statusCalled) {
            // var status;
            if (prevMoveCalled) {
                prevMoveCalled = false;
            } else {
                step++;
            }
            $.ajax({
                url: x + "/nextMove",
                type: 'POST',
                data: {"step": step},
                success: function (response) {
                    //step = response.step;
                    if (response.checkStatus === "Draw") {
                        alertStatus = "Match Draw!";
                        statusCalled = true;
                    } else if (response.checkStatus === "Player1") {
                        alertStatus = "Player 1 Wins (White)!";
                        statusCalled = true;
                    } else if (response.checkStatus === "Player2") {
                        alertStatus = "Player 2 Wins (Black)!";
                        statusCalled = true;
                    }
                    var pgnMove = response.pgn;
                    game.move(pgnMove)
                    board.position(game.fen())

                }
            });
            nextCalled = true;

        }

    }

    function prevStep() {


        if (step > 0) {
            if (!nextCalled) {
                if (step > 1)
                    step--;
            }

            // var x = window.location.origin;
            // $.ajax({
            //     url: x + "/previous_step",
            //     type: 'POST',
            //     success: function (response) {
            statusCalled = false;
            game.undo()
            board.position(game.fen())
            //     }
            //
            // });
            nextCalled = false;
            prevMoveCalled = true;

        }
    }

    function startNew() {
        step = 0;
        statusCalled = false;
    }
</script>
</body>
</html>
 