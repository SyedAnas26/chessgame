<!DOCTYPE unspecified PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <script>
        history.forward();
    </script>
</head>
<!-- Order of inclusion : Library -> Utilities -> Pieces -> Controls -->

<script type="text/javascript" src="../clientlib/jquery.min-3.5.js"></script>
<script type="text/javascript" src="../clientlib/jquery-ui.min.js"></script>
<script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js" integrity="sha384-8Vi8VHwn3vjQ9eUHUxex3JSN/NFqUg3QbPyX8kWyb93+8AC/pPWTzj+nHtbC5bxD" crossorigin="anonymous"></script>
<script src="https://requirejs.org/docs/release/2.3.5/minified/require.js"></script>

<script type="text/javascript">
var x=window.location.origin;
    $.ajax({
        url: x+"/getUserId",
        type: 'POST',
        success: function (response) {
            if (response.user_id==='null') {
                alert(' Login First !');
                location = '/loginpage';
            }
            console.log('difficulty ajax success!!');
        }
    });

    $("#chess_board").ready(function() {

        require(['./chess.js'], function (Chess) { const chess = new Chess() });

        var config = {
          draggable: true,
          position: 'start',
          onDrop: onDrop
        }

        var board = Chessboard('chess_board', config)

        function onDrop (source, target, piece, newPos, oldPos, orientation) {
          if (piece.search(chess.turn() == 'b')) {
            return 'snapback'
          }

           if(chess.move({ from: oldPos, to: newPos }) == null)
           {
            return 'snapback'
           }

            callAIToPlay();

            function callAIToPlay()
            {
                var x=window.location.origin;
                console.log("Inside ai Player");
                $.ajax({
                    url: x+"/aiMove",
                    type: 'POST',
                    success: function(response) {
                        chess.move({ from: response.from_pos, to: response.to_pos });
                        board.move("'" + response.from_pos  + "-" + response.to_pos + "'");
                    }
                });
            }
        };

        $(".claimed_draw").click(function(){
            var x = window.location.origin;
            $.ajax({
                url: x + "/drawclaim",
                type: 'POST',
                data: {"claimDraw":"1"},
                success: function () {
                    alert("Match Draw");
                    window.location=x + "/homepage";
                    console.log('draw ajax success!!');
                },
                error: function (jqXHR, exception) {
                    console.log('draw ajax Error occured!!');
                }
            });
        });
    });


</script>

<body>

<div id="chess_board" style="width: 400px"></div>

<br><br>
<input type="button" class="claimed_draw" value="Claim Draw" cellpadding="0" cellspacing="0"/>
<br><br>
<form action="/homepage" class="claimed_draw" method="post" align="center" >
    <input type="submit" value="Go Back to Home Page"/>
</form>
</body>
</html>